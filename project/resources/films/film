SELECT
	(REPLACE(str(?film), "http://www.wikidata.org/entity/", "") as ?id)
	(?filmLabel as ?title)
	?released
WHERE
{
SELECT		
?film
?filmLabel
?genreLabelGroupBy
(MIN(?released) AS ?released)
WHERE		
{
SELECT
?film
?filmLabel
?released
#(concat("['", group_concat(?genreLabel; separator="','"),"']") AS ?genreLabelGroupBy)
(concat('["', group_concat(?genreLabel; separator='","'),'"]') AS ?genreLabelGroupBy)
WHERE
{
SELECT
?film
?filmLabel
?released
?genreLabel
?countryOriginLabel
WHERE
{
{SELECT 						
distinct
?film
?filmLabel						
(str(year(?publicationDate)) AS ?released)
?genreLabel
?countryOriginLabel
?countryPublicationLabel
?country
WHERE {						
?film					wdt:P31 			wd:Q11424 .
?film					rdfs:label 			?filmLabel .
					
?film					wdt:P161			wd:Q43416 .
OPTIONAL {
?film					wdt:P136 			?genre .
?genre 					rdfs:label 			?genreLabel .
FILTER (lang(?genreLabel) 				= "en") .			
}  		
OPTIONAL {
?film					wdt:P495			?countryOrigin .
?countryOrigin			rdfs:label			?countryOriginLabel .
FILTER (lang(?countryOriginLabel)		= "en") .
}  		
OPTIONAL {
?film					wdt:P577			?publicationDate .
}  		
OPTIONAL {
?film 					p:P577				?propPublicationDate .
?propPublicationDate	ps:P577				?publicationDate .
?propPublicationDate	pq:P291				?countryPublication .	
?countryPublication		rdfs:label			?countryPublicationLabel .	
FILTER (lang(?countryPublicationLabel)	= "en")  .
}
FILTER (lang(?filmLabel) 				= "en") .			

BIND(IF(!BOUND(?countryPublicationLabel), 1, IF(?countryOriginLabel = ?countryPublicationLabel, 1, 0)) AS ?country) .
}}
FILTER (?country = 1)
}
}
GROUP BY ?film ?filmLabel ?released
}
GROUP BY
?film ?filmLabel ?genreLabelGroupBy
}
ORDER BY ?filmLabel